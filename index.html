<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Skygridlb â€“ Cemetery Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
html,body{height:100%;margin:0}
#map{height:100vh;width:100vw}

/* SEARCH (top-left) */
#searchBox{
  position:absolute;
  top:10px; left:10px;
  z-index:1000;
  background:#fff;
  padding:8px 10px;
  border-radius:10px;
  box-shadow:0 2px 10px rgba(0,0,0,.15);
  display:flex;
  gap:6px;
  align-items:center;
  font-family:Arial,sans-serif;
}
#searchInput{
  width:260px;
  padding:7px 10px;
  border:1px solid rgba(0,0,0,.15);
  border-radius:10px;
  outline:none;
}
#searchBtn,#clearBtn{
  padding:7px 10px;
  cursor:pointer;
  border:1px solid rgba(0,0,0,.15);
  border-radius:10px;
  background:#f7f7f7;
}

/* MARONITE LOGO (top-right) */
#partnerLogo{
  position:absolute;
  top:10px; right:10px;
  z-index:1000;
  background:#fff;
  padding:6px 10px;
  border-radius:12px;
  box-shadow:0 2px 10px rgba(0,0,0,.18);
}
#partnerLogo img{
  height:52px;
  width:auto;
  display:block;
}

/* BRAND CARD (bottom-left) */
#brandBox{
  position:absolute;
  bottom:15px; left:15px;
  z-index:1000;
  background:#fff;
  padding:14px 18px;
  border-radius:18px;
  box-shadow:0 4px 16px rgba(0,0,0,.22);
  display:flex;
  gap:20px;
  align-items:center;
  max-width:720px;
  font-family:Arial,sans-serif;
}

.brandLogoCol{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:6px;
  flex:0 0 auto;
}
.poweredBy{
  font-size:12px;
  font-weight:800;
  color:#000;
  letter-spacing:.3px;
  line-height:1;
  text-align:center;
}
.brandLogoCol img{
  height:72px;
  width:auto;
  display:block;
}

.brandText{
  display:flex;
  flex-direction:column;
  justify-content:center;
  line-height:1.25;
}
.brandName{font-size:16px;font-weight:800;letter-spacing:.4px}
.brandRole{font-size:12.5px;font-weight:600;opacity:.9}
.brandContact{margin-top:6px;font-size:12.5px}
.brandContact a{color:#000;text-decoration:none}
.brandContact a:hover{text-decoration:underline}

.socialRow{
  margin-top:6px;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  font-size:11.5px;
}
.socialRow a{
  padding:4px 10px;
  border-radius:14px;
  background:rgba(0,0,0,.08);
  font-weight:600;
  text-decoration:none;
  color:#000;
}

.brandTagline{
  margin-top:6px;
  font-size:11px;
  letter-spacing:.6px;
  opacity:.75;
}

/* POLYGON LABELS */
.polyLabel{
  font-family:Arial,sans-serif;
  font-weight:700;
  font-size:11px;
  color:#111;
  text-shadow:0 0 2px #fff,0 0 6px #fff;
  pointer-events:none;
}

/* =========================
   âœ… MOBILE FIXES
   ========================= */
@media (max-width: 600px){

  /* Search becomes full width */
  #searchBox{
    left:10px;
    right:10px;
    width:auto;
    padding:8px;
    gap:6px;
  }
  #searchInput{
    width:100%;
  }
  #searchBtn,#clearBtn{
    display:none; /* keep it clean on mobile; Enter key still works */
  }

  /* Move Maronite logo BELOW search, prevent overlap */
  #partnerLogo{
    top:64px;       /* below the search bar */
    right:10px;
    padding:6px 8px;
  }
  #partnerLogo img{
    height:38px;    /* smaller on mobile */
  }

  /* Make branding card smaller and centered, not huge */
  #brandBox{
    left:10px;
    right:10px;
    bottom:10px;
    width:auto;
    max-width:none;
    padding:10px 12px;
    gap:12px;
    border-radius:16px;
  }

  .poweredBy{ font-size:10.5px; }
  .brandLogoCol img{ height:54px; }

  .brandName{ font-size:14px; }
  .brandRole{ font-size:11px; }
  .brandContact{ font-size:11px; margin-top:4px; }

  .socialRow{ font-size:10.5px; gap:6px; margin-top:5px; }
  .socialRow a{ padding:3px 8px; border-radius:12px; }

  .brandTagline{ font-size:10px; margin-top:5px; }
}
</style>
</head>

<body>

<!-- SEARCH -->
<div id="searchBox">
  <input id="searchInput" placeholder="Search by ID or Name">
  <button id="searchBtn">Search</button>
  <button id="clearBtn">Clear</button>
</div>

<!-- MARONITE LOGO -->
<div id="partnerLogo">
  <img src="logo/Maronite.png" alt="Maronite">
</div>

<!-- BRAND CARD -->
<div id="brandBox">
  <div class="brandLogoCol">
    <div class="poweredBy">Powered by</div>
    <img src="logo/skygridlb.png" alt="Skygridlb">
  </div>

  <div class="brandText">
    <div class="brandName">FADI KASS HANNA</div>
    <div class="brandRole">OWNER | GENERAL MANAGER</div>
    <div class="brandRole">GEO SPATIAL ENGINEER</div>

    <div class="brandContact">
      <a href="tel:+96171709417">+961 71 709 417</a><br>
      <a href="mailto:fadi@skygridlb.com">fadi@skygridlb.com</a>
    </div>

    <div class="socialRow">
      <a href="https://facebook.com/skygridlb" target="_blank">Facebook</a>
      <a href="https://instagram.com/skygridlb" target="_blank">Instagram</a>
      <a href="https://linkedin.com/company/skygridlb" target="_blank">LinkedIn</a>
    </div>

    <div class="brandTagline">YOUR SPACE â€¢ OUR DATA</div>
  </div>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  // MAP
  var map = L.map('map', { zoomControl:false, maxZoom:20 }).setView([34.38106,35.90435], 18);
  L.control.zoom({ position:'bottomright' }).addTo(map);

  // OSM + ORTHO
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom:20 }).addTo(map);
  L.tileLayer('tiles/{z}/{x}/{y}.png', { minZoom:16, maxZoom:20, opacity:1 }).addTo(map);

  // Data index + label layers
  var tombsIndex = [];
  var labelLayers = [];

  function refreshLabels(){
    var show = map.getZoom() >= 18;
    labelLayers.forEach(function(layer){
      if (show) {
        if (!layer.getTooltip()) {
          layer.bindTooltip(layer._labelId || "", {
            permanent:true,
            direction:'center',
            className:'polyLabel',
            opacity:1
          });
        }
      } else {
        if (layer.getTooltip()) layer.unbindTooltip();
      }
    });
  }
  map.on('zoomend', refreshLabels);

  // Load GeoJSON with popups + photo links
  fetch('data/Tombs.geojson')
    .then(function(r){
      if(!r.ok) throw new Error("GeoJSON not found: data/Tombs.geojson (HTTP " + r.status + ")");
      return r.json();
    })
    .then(function(data){
      L.geoJSON(data, {
        style: { color:'#00ff00', weight:2, fillOpacity:0.2 },
        onEachFeature: function(feature, layer){
          var p = feature.properties || {};
          var id = (p.Id ?? "").toString();
          var name = (p.Name ?? "").toString();
          var photoUrl = "photos/" + id + ".jpg";

          layer.bindPopup(
            "<b>Name:</b> " + (name || "") + "<br>" +
            "<b>ID:</b> " + (id || "") + "<br><br>" +
            '<a href="' + photoUrl + '" target="_blank">ðŸ“· Open photo</a>'
          );

          layer._labelId = id;
          labelLayers.push(layer);

          tombsIndex.push({
            id: id.toLowerCase(),
            name: name.toLowerCase(),
            layer: layer
          });
        }
      }).addTo(map);

      refreshLabels();
    })
    .catch(function(err){
      alert(err.message);
      console.log(err);
    });

  // Search
  function doSearch(){
    var q = (document.getElementById('searchInput').value || "").trim().toLowerCase();
    if(!q) return;

    var hit = tombsIndex.find(x => x.id === q) || tombsIndex.find(x => x.name.includes(q));
    if(!hit){
      alert("Not found");
      return;
    }

    var layer = hit.layer;
    if(layer.getBounds) map.fitBounds(layer.getBounds(), { maxZoom:20 });
    layer.openPopup();
  }

  function clearSearch(){
    document.getElementById('searchInput').value = "";
  }

  document.getElementById('searchBtn').addEventListener('click', doSearch);
  document.getElementById('clearBtn').addEventListener('click', clearSearch);
  document.getElementById('searchInput').addEventListener('keydown', function(e){
    if(e.key === "Enter") doSearch();
  });
</script>

</body>
</html>
