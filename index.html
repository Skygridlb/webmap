<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Zgharta Cemetery Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
html,body{ height:100%; margin:0; }
#map{ height:100%; width:100%; }

/* ================= TOP UI ================= */
#topUI{
  position:fixed;
  top:env(safe-area-inset-top,0px);
  left:0; right:0;
  z-index:2000;
  display:flex;
  flex-direction:column;
  gap:8px;
  padding:10px;
  pointer-events:none;
}
#searchBox{
  background:#fff;
  padding:8px;
  border-radius:14px;
  box-shadow:0 2px 10px rgba(0,0,0,.15);
  display:flex;
  gap:6px;
  align-items:center;
  font-family:Arial,sans-serif;
  pointer-events:auto;
}
#searchInput{
  flex:1;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid rgba(0,0,0,.2);
  font-size:14px;
  outline:none;
}
.searchBtn{
  padding:10px 14px;
  border-radius:12px;
  border:1px solid rgba(0,0,0,.2);
  background:#f2f2f2;
  font-size:13px;
  font-weight:700;
  cursor:pointer;
}
.searchBtn:active{ background:#ddd; }

/* LOGO */
#partnerLogo{
  align-self:flex-end;
  background:#fff;
  padding:6px 10px;
  border-radius:12px;
  box-shadow:0 2px 10px rgba(0,0,0,.18);
  pointer-events:auto;
}
#partnerLogo img{ height:40px; }

/* ================= BRAND CARD ================= */
#brandBox{
  position:fixed;
  bottom:env(safe-area-inset-bottom,10px);
  left:10px; right:10px;
  z-index:2000;
  background:#fff;
  padding:10px 14px;
  border-radius:18px;
  box-shadow:0 4px 16px rgba(0,0,0,.22);
  display:flex;
  gap:14px;
  align-items:center;
  font-family:Arial,sans-serif;
}
.brandLogoCol{ display:flex; flex-direction:column; align-items:center; gap:4px; }
.poweredBy{ font-size:10px; font-weight:800; }
.brandLogoCol img{ height:48px; }
.brandText{ line-height:1.2; }
.brandName{ font-size:14px; font-weight:800; }
.brandRole{ font-size:11px; font-weight:600; }
.brandContact{ font-size:11px; margin-top:4px; }
.socialRow{ display:flex; gap:6px; flex-wrap:wrap; margin-top:4px; }
.socialRow a{
  font-size:10.5px;
  padding:4px 10px;
  border-radius:12px;
  background:rgba(0,0,0,.08);
  text-decoration:none;
  color:#000;
  font-weight:700;
}
.brandTagline{ font-size:10px; opacity:.75; margin-top:4px; }

/* LABELS (supports Arabic) */
.vecLabel{
  font-family: Arial, sans-serif;
  font-weight: 800;
  font-size: 11px;
  text-shadow: 0 0 2px #fff, 0 0 6px #fff;
  pointer-events: none;
  direction: rtl;            /* good for Arabic */
  unicode-bidi: plaintext;   /* keeps Arabic ordering correct */
}
</style>
</head>

<body>

<!-- TOP UI -->
<div id="topUI">
  <div id="searchBox">
    <input id="searchInput" placeholder="Search by Grave_ID">
    <button id="searchBtn" class="searchBtn">Search</button>
    <button id="clearBtn" class="searchBtn">Clear</button>
  </div>

  <div id="partnerLogo">
    <img src="logo/Maronite.png" alt="Maronite">
  </div>
</div>

<!-- BRAND CARD -->
<div id="brandBox">
  <div class="brandLogoCol">
    <div class="poweredBy">Powered by</div>
    <img src="logo/skygridlb.png">
  </div>

  <div class="brandText">
    <div class="brandName">FADI KASS HANNA</div>
    <div class="brandRole">OWNER | GENERAL MANAGER</div>
    <div class="brandRole">GEO SPATIAL ENGINEER</div>

    <div class="brandContact">
      +961 71 709 417<br>
      fadi@skygridlb.com
    </div>

    <div class="socialRow">
      <a href="https://facebook.com/skygridlb" target="_blank">Facebook</a>
      <a href="https://instagram.com/skygridlb" target="_blank">Instagram</a>
      <a href="https://linkedin.com/company/skygridlb" target="_blank">LinkedIn</a>
    </div>

    <div class="brandTagline">YOUR SPACE â€¢ OUR DATA</div>
  </div>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
/** ZOOM RULES **/
const MIN_Z = 16;
const MAX_Z = 23;
const LABEL_Z = 18; // show labels from this zoom and above (change if you want)

/** MAP **/
var map = L.map('map', {
  zoomControl: false,
  minZoom: MIN_Z,
  maxZoom: MAX_Z
}).setView([34.38106, 35.90435], 18);

L.control.zoom({position:'bottomright'}).addTo(map);

/** BASEMAP (OSM) **/
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  minZoom: MIN_Z,
  maxZoom: MAX_Z,
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

/** ORTHO / RASTER TILES (JPEG) **/
L.tileLayer('tiles/{z}/{x}/{y}.jpeg', {
  minZoom: MIN_Z,
  maxZoom: MAX_Z,
  tms: false
}).addTo(map);

/** LABEL MANAGEMENT **/
var labelLayers = [];   // all layers that can show a tooltip label
function refreshLabels(){
  var show = map.getZoom() >= LABEL_Z;
  labelLayers.forEach(l => {
    if(show){
      if(!l.getTooltip()){
        l.bindTooltip(l._labelText || '', {
          permanent: true,
          direction: 'center',
          className: 'vecLabel',
          opacity: 0.95
        });
      }
    }else{
      if(l.getTooltip()) l.unbindTooltip();
    }
  });
}
map.on('zoomend', refreshLabels);

/** SEARCH INDEX (Graves) **/
var gravesIndex = [];   // {idLower, layer}

/** GRAVES (GeoJSON) **/
fetch('data/Graves.geojson')
  .then(r => r.json())
  .then(data => {
    L.geoJSON(data, {
      style: { color:'#00ff00', weight:2, fillOpacity:0.2 },
      onEachFeature: (f, l) => {
        const gid = (f.properties?.Grave_ID ?? '').toString().trim();

        // Label
        l._labelText = gid;
        labelLayers.push(l);

        // Popup (you can add more fields if you want)
        let popupHTML = `<b>Grave_ID:</b> ${gid}`;
        // Optional: if you have a photo naming rule by Grave_ID, uncomment:
        // const photo = `photos/${gid}.jpg`;
        // popupHTML += `<br><br><a href="${photo}" target="_blank">ðŸ“· Open photo</a>`;
        l.bindPopup(popupHTML);

        // Search index
        if(gid) gravesIndex.push({ idLower: gid.toLowerCase(), layer: l });
      }
    }).addTo(map);

    refreshLabels();
  })
  .catch(err => console.error('Failed loading Graves.geojson', err));

/** STREETS (GeoJSON) **/
fetch('data/Streets.geojson')
  .then(r => r.json())
  .then(data => {
    L.geoJSON(data, {
      style: { color:'#ff9900', weight:3, opacity:0.9 },
      onEachFeature: (f, l) => {
        const sname = (f.properties?.StreetName ?? '').toString().trim();

        // Label (Arabic supported by CSS direction + bidi)
        l._labelText = sname;
        labelLayers.push(l);

        // Popup
        l.bindPopup(`<b>StreetName:</b> ${sname}`);
      }
    }).addTo(map);

    refreshLabels();
  })
  .catch(err => console.error('Failed loading Streets.geojson', err));

/** SEARCH (by Grave_ID) **/
function doSearch(){
  let q = document.getElementById('searchInput').value.trim().toLowerCase();
  if(!q) return;

  let hit = gravesIndex.find(x => x.idLower === q);
  if(hit){
    map.fitBounds(hit.layer.getBounds(), { maxZoom: MAX_Z });
    hit.layer.openPopup();
  }
}

document.getElementById('searchBtn').onclick = doSearch;
document.getElementById('clearBtn').onclick = () => { document.getElementById('searchInput').value=""; };
document.getElementById('searchInput').addEventListener('keydown', e => { if(e.key==="Enter") doSearch(); });
</script>

</body>
</html>
