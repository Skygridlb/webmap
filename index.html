<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Zgharta Cemetery Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet-textpath@1.2.3/leaflet.textpath.css"/>

<style>
html,body{ height:100%; margin:0; }
#map{ height:100%; width:100%; }

/* Label style */
.vecLabel{
  font-family: Arial, sans-serif;
  font-weight: 700;
  font-size: 11px;
  text-shadow: 0 0 3px #fff, 0 0 6px #fff;
  pointer-events: none;
}
</style>
</head>

<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-textpath@1.2.3/leaflet.textpath.js"></script>

<script>

/* ================= SETTINGS ================= */

const MIN_Z = 16;
const MAX_Z = 23;
const GRAVE_LABEL_Z = 20;   // graves start at zoom 20
const TILES_MAX_NATIVE_Z = 21; // change if you have tiles 22/23

/* ================= MAP ================= */

var map = L.map('map', {
  minZoom: MIN_Z,
  maxZoom: MAX_Z
}).setView([34.38106, 35.90435], 18);

/* ================= RASTER ONLY ================= */

L.tileLayer('tiles/{z}/{x}/{y}.jpg', {
  minZoom: MIN_Z,
  maxZoom: MAX_Z,
  minNativeZoom: MIN_Z,
  maxNativeZoom: TILES_MAX_NATIVE_Z,
  tms: false
}).addTo(map);

/* ================= LABEL MANAGEMENT ================= */

var graveLayers = [];

function refreshGraveLabels(){
  let show = map.getZoom() >= GRAVE_LABEL_Z;

  graveLayers.forEach(l => {
    if(show){
      if(!l.getTooltip()){
        l.bindTooltip(l._labelText || '', {
          permanent: true,
          direction: 'center',
          className: 'vecLabel'
        });
      }
    } else {
      if(l.getTooltip()) l.unbindTooltip();
    }
  });
}

map.on('zoomend', refreshGraveLabels);

/* ================= GRAVES ================= */

fetch('data/Graves.geojson')
  .then(r => r.json())
  .then(data => {

    L.geoJSON(data, {

      /* Red outline only */
      style: function(feature){
        return {
          color: '#ff0000',
          weight: 1.5,
          fill: false
        };
      },

      onEachFeature: function(feature, layer){

        const gid = feature.properties?.Grave_ID || '';

        layer._labelText = gid;
        graveLayers.push(layer);

        layer.bindPopup(`<b>Grave_ID:</b> ${gid}`);

      }

    }).addTo(map);

    refreshGraveLabels();
  });


/* ================= STREETS ================= */
/* IMPORTANT: Must be EPSG:4326 (lat/long) */

fetch('data/Streets.geojson')
  .then(r => r.json())
  .then(data => {

    L.geoJSON(data, {

      /* Green streets */
      style: function(feature){
        return {
          color: '#008000',
          weight: 2.5
        };
      },

      onEachFeature: function(feature, layer){

        const name = feature.properties?.StreetName || '';

        /* Parallel label centered on line */
        layer.setText(name, {
          center: true,
          offset: 0,
          attributes: {
            fill: '#008000',
            fontSize: '12px',
            fontWeight: 'bold'
          }
        });

      }

    }).addTo(map);

  });

</script>
</body>
</html>
